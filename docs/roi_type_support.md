# 分析服务新增功能

## ROI类型支持

分析服务现在支持多种ROI类型，可以更灵活地设置检测区域：

### 1. 矩形ROI (Rectangle, type=1)

最基本的ROI类型，使用左上和右下坐标定义一个矩形区域。

```json
{
  "roi_type": 1,
  "roi": {
    "x1": 0.1, 
    "y1": 0.1,
    "x2": 0.9,
    "y2": 0.9
  }
}
```

### 2. 多边形ROI (Polygon, type=2)

使用任意多个点定义一个多边形区域。

```json
{
  "roi_type": 2,
  "roi": {
    "points": [
      [0.1, 0.1],
      [0.9, 0.1],
      [0.9, 0.9],
      [0.1, 0.9]
    ]
  }
}
```

### 3. 线段ROI (Line, type=3)

使用两个点定义一条线段，检测穿越该线段的目标。

```json
{
  "roi_type": 3,
  "roi": {
    "points": [
      [0.1, 0.5],
      [0.9, 0.5]
    ]
  }
}
```

## 分析类型支持

分析服务新增对多种分析类型的支持：

1. **detection** - 目标检测
2. **tracking** - 目标跟踪
3. **counting** - 计数分析
4. **segmentation** - 实例分割

## 自动回调支持

现在分析服务会自动添加系统级回调，确保API服务能够接收到分析结果。

1. 如果请求中指定了`callback_url`，则优先使用该URL
2. 如果没有指定，则根据请求来源自动构建一个系统回调URL
3. 所有回调都包含图片的base64编码数据

## 任务ID传递

分析服务现在支持从请求中接收任务ID，而不是总是自动生成。这使得API服务可以管理任务的生命周期，同时与分析服务保持同步。 